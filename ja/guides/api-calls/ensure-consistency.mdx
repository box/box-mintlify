---
title: ヘッダーによる一貫性の確保

fullyTranslated: true
---

import {Link} from "/snippets/Link.jsx";

import {RelatedLinks, MultiRelatedLinks} from "/snippets/related-links.jsx";

一部のBox APIでは、アプリケーションとBox間の一貫性を確保するために使用されるヘッダーがサポートされています。

## `etag`、`if-match`、および`if-none-match`

APIを介してリクエスト可能なファイルシステムの項目 (ファイルまたはフォルダ) の多くは、項目の`etag`値を返します。

たとえば、ファイルリソースはJSONレスポンスで`etag`を返します。

```sh
curl https://api.box.com/2.0/files/12345 \
    -H "authorization: Bearer ACCESS_TOKEN"
```

```json
{
  "id": 12345,
  "etag": 1,
  "type": "file",
  "sequence_id": 3,
  "name": "Contract.pdf",
  ...
}
```

この`etag`を`if-match`または`if-none-match`ヘッダーの値として使用できるのは、`etag`値が受信されてからリソースが変更されていないことを確認するためか、または変更されていない項目を不必要にダウンロードしないようにするためです。

たとえば、同じファイルを取得するのはそのファイルが変更された場合のみにするには、`if-none-match`ヘッダーで`etag`値を渡します。

```sh
curl https://api.box.com/2.0/files/12345 \
    -H "authorization: Bearer ACCESS_TOKEN" \
    -H "if-none-match: 1"
```

ファイルが変更されていない場合、このAPIコールでは空のレスポンスが返されます。

## 一貫性のある変更の確保

`if-match`ヘッダーを使用すると、アプリケーションは、最後に調べた項目がその後別のアプリケーションまたはユーザーによって変更が加えられても、項目が変更されないようにすることができます。これにより、2つのアプリケーションまたは2人のユーザーが項目を同時に変更しても変更が失われることはありません。

このヘッダーは、以下のエンドポイントでサポートされます。

| `if-match`対応のエンドポイント                                                           |                     |
| ------------------------------------------------------------------------------ | ------------------- |
| <Link href="/reference/post-files-id-content">`POST /files/:id/content`</Link> | 新しいファイルバージョンをアップロード |
| <Link href="/reference/put-files-id">`PUT /files/:id`</Link>                   | ファイルの情報を更新          |
| <Link href="/reference/delete-files-id">`DELETE /files/:id`</Link>             | ファイルを削除             |
| <Link href="/reference/put-folders-id">`PUT /folders/:id`</Link>               | フォルダの情報を更新          |
| <Link href="/reference/delete-folders-id">`DELETE /folders/:id`</Link>         | フォルダを削除             |
| <Link href="/reference/put-web-links-id">`PUT /web_links/:id`</Link>           | ウェブリンクの情報を更新        |
| <Link href="/reference/delete-web-links-id">`DELETE /web_links/:id`</Link>     | ウェブリンクを削除           |

これらのAPIコールのレスポンスは、項目が存在するかどうか、および`etag`値が最新バージョンと一致するかどうかによって異なります。

| 項目があるか? | Etagが一致するか? | HTTPステータス |
| ------- | ----------- | --------- |
| はい      | はい          | 200       |
| はい      | いいえ         | 412       |
| いいえ     | はい          | 412       |
| いいえ     | いいえ         | 404       |

<Warning>
  **項目の移動**

  `if-match`ヘッダーを使用してファイル、フォルダ、またはウェブリンクの移動を防ぐことはできません。Boxでは、必ず最新の項目が新しい場所に移動されます。
</Warning>

## リクエストによる不要なダウンロードの防止

`if-none-match`ヘッダーを使用すると、アプリケーションは、最後に調べてから変更されていない項目の情報がダウンロードされないようにすることができます。これにより、不要な情報がダウンロードされなくなるため、アプリケーションの速度が向上し、帯域幅が節約されます。

| `if-none-match`対応のエンドポイント                                            |              |
| -------------------------------------------------------------------- | ------------ |
| <Link href="/reference/get-files-id">`GET /files/:id`</Link>         | ファイルの情報を取得   |
| <Link href="/reference/get-folder-id">`GET /folders/:id`</Link>      | フォルダの情報を取得   |
| <Link href="/reference/get-web-links-id">`GET /web_links/:id`</Link> | ウェブリンクの情報を取得 |
| <Link href="/reference/get-shared-items">`GET /shared_items`</Link>  | 共有項目の情報を取得   |

これらのAPIコールのレスポンスは、項目が存在するかどうか、および`etag`値が最新バージョンと一致するかどうかによって異なります。

| 項目があるか? | Etagが一致するか? | HTTPステータス |
| ------- | ----------- | --------- |
| はい      | はい          | 304       |
| はい      | いいえ         | 200       |
| いいえ     | はい          | 404       |
| いいえ     | いいえ         | 404       |

<RelatedLinks
  title="関連するAPI"
  items={[
  { label: "Upload file version", href: "/reference/post-files-id-content", badge: "POST" },
  { label: "Update file", href: "/reference/put-files-id", badge: "PUT" },
  { label: "Delete file", href: "/reference/delete-files-id", badge: "DELETE" },
  { label: "Update folder", href: "/reference/put-folders-id", badge: "PUT" },
  { label: "Delete folder", href: "/reference/delete-folders-id", badge: "DELETE" },
  { label: "Update web link", href: "/reference/put-web-links-id", badge: "PUT" },
  { label: "Remove web link", href: "/reference/delete-web-links-id", badge: "DELETE" },
  { label: "Get file information", href: "/reference/get-files-id", badge: "GET" },
  { label: "Get folder information", href: "/reference/get-folders-id", badge: "GET" },
  { label: "Get web link", href: "/reference/get-web-links-id", badge: "GET" },
  { label: "Find file for shared link", href: "/reference/get-shared-items", badge: "GET" }
]}
/>
